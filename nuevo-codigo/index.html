<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biblioteca  -  Lectorium</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');
    
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #7c3aed;
      --success: #059669;
      --warning: #d97706;
      --danger: #dc2626;
      --info: #0284c7;
      --dark: #1f2937;
      --light: #f8fafc;
    }
    
    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --border-color: #475569;
    }
    
    [data-theme="light"] {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #e2e8f0;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --border-color: #e2e8f0;
    }
    
    * {
      scroll-behavior: smooth;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    [data-theme="dark"] .glass {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(100, 116, 139, 0.2);
    }
    
    [data-theme="light"] .glass {
      background: rgba(248, 250, 252, 0.9);
      border: 1px solid rgba(226, 232, 240, 0.5);
    }
    
    .card {
      background: var(--bg-primary);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
    }
    
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.15);
    }
    
    .hover-scale {
      transition: transform 0.2s ease;
    }
    
    .hover-scale:hover {
      transform: scale(1.02);
    }
    
    .nav-item {
      position: relative;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .nav-item.active {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
    }
    
    .nav-item:hover:not(.active) {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    
    .resource-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
    }
    
    .resource-card {
      background: var(--bg-primary);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
    }
    
    .resource-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.15);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(37, 99, 235, 0.4);
    }
    
    .btn-secondary {
      background: var(--bg-primary);
      color: var(--text-primary);
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
      background: var(--bg-tertiary);
      transform: translateY(-1px);
    }
    
    @media (max-width: 768px) {
      .resource-grid {
        grid-template-columns: 1fr;
      }
      
      .card {
        padding: 16px;
      }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .hero-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 60px 0;
      margin-bottom: 40px;
    }
    
    .search-bar {
      position: relative;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .search-input {
      width: 100%;
      padding: 16px 20px 16px 60px;
      border-radius: 50px;
      border: none;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
    }
    
    .search-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 40px 0;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 8px;
    }
    
    .section-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 24px;
      color: var(--text-primary);
    }
    
    .category-filter {
      display: flex;
      gap: 12px;
      margin-bottom: 32px;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      padding: 8px 16px;
      border-radius: 20px;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .filter-btn.active,
    .filter-btn:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="glass sticky top-0 z-50 px-6 py-4">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <div class="bg-gradient-to-br from-blue-600 to-purple-700 p-3 rounded-xl">
          <i class="fas fa-university text-white text-2xl"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold"> Lectorium</h1>
          <p class="text-sm opacity-80">Centro de Recursos para el Aprendizaje</p>
        </div>
      </div>
      
      <nav class="flex items-center space-x-6">
        <button id="themeToggle" class="p-3 rounded-full hover-scale">
          <i id="themeIcon" class="fas fa-moon text-xl"></i>
        </button>
        <button class="hover-scale">
          <i class="fas fa-bell text-xl"></i>
        </button>
        <button id="loginBtn" class="btn-primary">
          <i class="fas fa-sign-in-alt mr-2"></i>
          Iniciar Sesión
        </button>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="max-w-7xl mx-auto px-6 text-center">
      <h2 class="text-4xl md:text-5xl font-bold mb-6">
        Lectorium
      </h2>
      <p class="text-xl opacity-90 mb-8 max-w-3xl mx-auto">
        Accede a miles de recursos académicos, libros digitales, bases de datos especializadas y contenido multimedia educativo
      </p>
      
      <!-- Search Bar -->
      <div class="search-bar mb-8">
        <div class="relative">
          <i class="fas fa-search search-icon text-xl"></i>
          <input 
            type="text" 
            class="search-input"
            placeholder="Buscar libros, artículos, recursos..."
          >
        </div>
      </div>
      
      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">10+</div>
          <div>Libros Digitales</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">10</div>
          <div>Bases de Datos</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">10</div>
          <div>Recursos Multimedia</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">24/7</div>
          <div>Acceso Disponible</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Navigation -->
  <main class="max-w-7xl mx-auto px-6 py-8">
    <div class="glass rounded-2xl p-6 mb-8">
      <div class="flex flex-wrap gap-4 justify-center">
        <div class="nav-item active" data-section="inicio">
          <i class="fas fa-home mr-2"></i>
          Inicio
        </div>
        <div class="nav-item" data-section="catalogo">
          <i class="fas fa-books mr-2"></i>
          Catálogo
        </div>
        <div class="nav-item" data-section="bases-datos">
          <i class="fas fa-database mr-2"></i>
          Bases de Datos
        </div>
        <div class="nav-item" data-section="repositorio">
          <i class="fas fa-archive mr-2"></i>
          Repositorio
        </div>
        <div class="nav-item" data-section="multimedia">
          <i class="fas fa-photo-video mr-2"></i>
          Multimedia
        </div>
        <div class="nav-item" data-section="servicios">
          <i class="fas fa-concierge-bell mr-2"></i>
          Servicios
        </div>
      </div>
    </div>

    <!-- Content Sections -->
    
    <!-- Inicio Section -->
    <section id="inicio" class="content-section fade-in">
      <h3 class="section-title">Acceso Rápido</h3>
      <div class="resource-grid">
        <div class="resource-card hover-scale">
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg">
                <i class="fas fa-search text-blue-600 text-2xl"></i>
              </div>
              <i class="fas fa-arrow-right text-gray-400"></i>
            </div>
            <h4 class="text-xl font-bold mb-2">Catálogo OPAC</h4>
            <p class="text-sm opacity-70 mb-4">Busca en nuestra colección completa de libros físicos y digitales</p>
            <button class="btn-primary w-full">
              Explorar Catálogo
            </button>
          </div>
        </div>

        <div class="resource-card hover-scale">
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <div class="bg-green-100 dark:bg-green-900 p-4 rounded-lg">
                <i class="fas fa-database text-green-600 text-2xl"></i>
              </div>
              <i class="fas fa-arrow-right text-gray-400"></i>
            </div>
            <h4 class="text-xl font-bold mb-2">Bases de Datos</h4>
            <p class="text-sm opacity-70 mb-4">Accede a recursos académicos especializados por disciplina</p>
            <button class="btn-primary w-full">
              Ver Bases de Datos
            </button>
          </div>
        </div>

        <div class="resource-card hover-scale">
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <div class="bg-purple-100 dark:bg-purple-900 p-4 rounded-lg">
                <i class="fas fa-graduation-cap text-purple-600 text-2xl"></i>
              </div>
              <i class="fas fa-arrow-right text-gray-400"></i>
            </div>
            <h4 class="text-xl font-bold mb-2">Repositorio Institucional</h4>
            <p class="text-sm opacity-70 mb-4">Trabajos de investigación y tesis de nuestra comunidad</p>
            <button class="btn-primary w-full">
              Explorar Repositorio
            </button>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="mt-12">
        <h3 class="section-title">Actividad Reciente</h3>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div class="card">
            <h4 class="text-xl font-bold mb-4">Nuevas Adquisiciones</h4>
            <div class="space-y-4">
              <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg">
                <i class="fas fa-book text-blue-600"></i>
                <div class="flex-1">
                  <p class="font-medium">Inteligencia Artificial y Educación</p>
                  <p class="text-sm opacity-70">Por: Dr. María García</p>
                </div>
                <span class="text-xs opacity-50">Hace 2 días</span>
              </div>
              <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg">
                <i class="fas fa-file-pdf text-red-600"></i>
                <div class="flex-1">
                  <p class="font-medium">Sostenibilidad Ambiental 2024</p>
                  <p class="text-sm opacity-70">Revista Científica</p>
                </div>
                <span class="text-xs opacity-50">Hace 1 semana</span>
              </div>
            </div>
          </div>

          <div class="card">
            <h4 class="text-xl font-bold mb-4">Recursos Más Consultados</h4>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg">
                <div>
                  <p class="font-medium">EBSCO Academic Search</p>
                  <p class="text-sm opacity-70">1,250 accesos este mes</p>
                </div>
                <i class="fas fa-chart-line text-green-500"></i>
              </div>
              <div class="flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg">
                <div>
                  <p class="font-medium">Biblioteca </p>
                  <p class="text-sm opacity-70">890 accesos este mes</p>
                </div>
                <i class="fas fa-chart-line text-green-500"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Bases de Datos Section -->
    <section id="bases-datos" class="content-section hidden">
      <h3 class="section-title">Bases de Datos Especializadas</h3>
      
      <!-- Category Filters -->
      <div class="category-filter">
        <button class="filter-btn active">Todas</button>
        <button class="filter-btn">Ciencias</button>
        <button class="filter-btn">Ingeniería</button>
        <button class="filter-btn">Humanidades</button>
        <button class="filter-btn">Medicina</button>
        <button class="filter-btn">Acceso Abierto</button>
      </div>

      <!-- Databases Grid -->
      <div class="resource-grid">
        <div class="resource-card">
          <div class="gradient-bg h-32 flex items-center justify-center">
            <i class="fas fa-database text-white text-4xl"></i>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-start mb-3">
              <h4 class="text-xl font-bold">EBSCO Academic</h4>
              <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-semibold">Suscrito</span>
            </div>
            <p class="text-sm opacity-70 mb-4">Base de datos multidisciplinaria con acceso a más de 10,000 publicaciones académicas revisadas por pares.</p>
            <div class="flex gap-2">
              <button class="btn-primary flex-1">Acceder</button>
              <button class="btn-secondary">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="resource-card">
          <div class="bg-gradient-to-br from-red-500 to-orange-600 h-32 flex items-center justify-center">
            <i class="fas fa-microscope text-white text-4xl"></i>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-start mb-3">
              <h4 class="text-xl font-bold">Science Direct</h4>
              <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-semibold">Suscrito</span>
            </div>
            <p class="text-sm opacity-70 mb-4">Plataforma líder en investigación científica con acceso a revistas de Elsevier en ciencias, tecnología y medicina.</p>
            <div class="flex gap-2">
              <button class="btn-primary flex-1">Acceder</button>
              <button class="btn-secondary">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="resource-card">
          <div class="bg-gradient-to-br from-blue-500 to-cyan-600 h-32 flex items-center justify-center">
            <i class="fas fa-book-open text-white text-4xl"></i>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-start mb-3">
              <h4 class="text-xl font-bold">SpringerLink</h4>
              <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-semibold">Suscrito</span>
            </div>
            <p class="text-sm opacity-70 mb-4">Acceso a libros, revistas y referencias de Springer en ciencias, tecnología, medicina y humanidades.</p>
            <div class="flex gap-2">
              <button class="btn-primary flex-1">Acceder</button>
              <button class="btn-secondary">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="resource-card">
          <div class="bg-gradient-to-br from-green-500 to-teal-600 h-32 flex items-center justify-center">
            <i class="fas fa-globe text-white text-4xl"></i>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-start mb-3">
              <h4 class="text-xl font-bold">DOAJ</h4>
              <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-semibold">Acceso Abierto</span>
            </div>
            <p class="text-sm opacity-70 mb-4">Directorio de revistas de acceso abierto con más de 17,000 revistas de alta calidad de todo el mundo.</p>
            <div class="flex gap-2">
              <button class="btn-primary flex-1">Acceder</button>
              <button class="btn-secondary">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="resource-card">
          <div class="bg-gradient-to-br from-purple-500 to-pink-600 h-32 flex items-center justify-center">
            <i class="fas fa-users text-white text-4xl"></i>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-start mb-3">
              <h4 class="text-xl font-bold">JSTOR</h4>
              <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-semibold">Suscrito</span>
            </div>
            <p class="text-sm opacity-70 mb-4">Archivo digital de revistas académicas, libros y fuentes primarias en humanidades y ciencias sociales.</p>
            <div class="flex gap-2">
              <button class="btn-primary flex-1">Acceder</button>
              <button class="btn-secondary">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="resource-card">
          <div class="bg-gradient-to-br from-yellow-500 to-orange-600 h-32 flex items-center justify-center">
            <i class="fas fa-search text-white text-4xl"></i>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-start mb-3">
              <h4 class="text-xl font-bold">Google Scholar</h4>
              <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-semibold">Gratuito</span>
            </div>
            <p class="text-sm opacity-70 mb-4">Buscador especializado en literatura académica: artículos, tesis, libros, abstracts y informes.</p>
            <div class="flex gap-2">
              <button class="btn-primary flex-1">Acceder</button>
              <button class="btn-secondary">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Other sections would go here (catalogo, repositorio, multimedia, servicios) -->
    <section id="catalogo" class="content-section hidden">
      <h3 class="section-title">Catálogo de Recursos</h3>
      <div class="card">
        <div class="text-center py-12">
          <i class="fas fa-books text-6xl opacity-20 mb-4"></i>
          <p class="text-xl font-semibold opacity-70">Función de catálogo en desarrollo</p>
          <p class="text-sm opacity-50">Pronto podrás buscar en toda nuestra colección</p>
        </div>
      </div>
    </section>

    <section id="repositorio" class="content-section hidden">
      <h3 class="section-title">Repositorio Institucional</h3>
      <div class="card">
        <div class="text-center py-12">
          <i class="fas fa-archive text-6xl opacity-20 mb-4"></i>
          <p class="text-xl font-semibold opacity-70">Repositorio en construcción</p>
          <p class="text-sm opacity-50">Aquí encontrarás tesis y trabajos de investigación</p>
        </div>
      </div>
    </section>

    <section id="multimedia" class="content-section hidden">
      <h3 class="section-title">Recursos Multimedia</h3>
      <div class="card">
        <div class="text-center py-12">
          <i class="fas fa-photo-video text-6xl opacity-20 mb-4"></i>
          <p class="text-xl font-semibold opacity-70">Biblioteca multimedia próximamente</p>
          <p class="text-sm opacity-50">Videos, audios y contenido interactivo educativo</p>
        </div>
      </div>
    </section>

    <section id="servicios" class="content-section hidden">
      <h3 class="section-title">Servicios Especializados</h3>
      <div class="card">
        <div class="text-center py-12">
          <i class="fas fa-concierge-bell text-6xl opacity-20 mb-4"></i>
          <p class="text-xl font-semibold opacity-70">Servicios en desarrollo</p>
          <p class="text-sm opacity-50">Asesorías, formación y apoyo a la investigación</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12 mt-16">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h4 class="text-xl font-bold mb-4"> Lectorium</h4>
          <p class="text-gray-300">Centro de Recursos para el Aprendizaje y la Investigación</p>
        </div>
        <div>
          <h5 class="font-semibold mb-4">Recursos</h5>
          <ul class="space-y-2 text-gray-300">
            <li><a href="#" class="hover:text-white">Catálogo OPAC</a></li>
            <li><a href="#" class="hover:text-white">Bases de Datos</a></li>
            <li><a href="#" class="hover:text-white">Repositorio</a></li>
            <li><a href="#" class="hover:text-white">Multimedia</a></li>
          </ul>
        </div>
        <div>
          <h5 class="font-semibold mb-4">Servicios</h5>
          <ul class="space-y-2 text-gray-300">
            <li><a href="#" class="hover:text-white">Préstamos</a></li>
            <li><a href="#" class="hover:text-white">Formación</a></li>
            <li><a href="#" class="hover:text-white">Asesorías</a></li>
            <li><a href="#" class="hover:text-white">Soporte Técnico</a></li>
          </ul>
        </div>
        <div>
          <h5 class="font-semibold mb-4">Contacto</h5>
          <ul class="space-y-2 text-gray-300">
            <li><i class="fas fa-envelope mr-2"></i>lectoriumlbiblioteca@gmail.com</li>
            <li><i class="fas fa-phone mr-2"></i>+57 313 6116029</li>
            <li><i class="fas fa-map-marker-alt mr-2"></i>Cartagena, Colombia</li>
          </ul>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
        <p>&copy; 2024  Lectorium. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Chat Widget -->
  <div class="fixed bottom-6 right-6 z-50">
    <button id="chatToggle" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-full shadow-lg hover-scale">
      <i class="fas fa-comments text-2xl"></i>
    </button>
  </div>

  <!-- Chat Window -->
  <div id="chatWindow" class="fixed bottom-24 right-6 w-80 h-96 glass rounded-2xl overflow-hidden z-40 hidden">
    <div class="gradient-bg text-white p-4">
      <div class="flex justify-between items-center">
        <div>
          <h4 class="font-semibold">Asistente </h4>
          <p class="text-sm opacity-90">En línea</p>
        </div>
        <button id="chatClose" class="hover:bg-white hover:bg-opacity-20 p-2 rounded">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div class="flex-1 p-4 h-64 overflow-y-auto bg-white dark:bg-gray-800" id="chatMessages">
      <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-3 mb-3">
        <p class="text-sm">¡Hola! Soy tu asistente virtual. ¿En qué puedo ayudarte hoy?</p>
      </div>
    </div>
    <div class="p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
      <div class="flex gap-2">
        <input 
          type="text" 
          id="chatInput" 
          class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          placeholder="Escribe tu pregunta..."
        >
        <button id="chatSend" class="btn-primary px-4">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentSection = 'inicio';
    
    // DOM elements
    const elements = {
      themeToggle: document.getElementById('themeToggle'),
      themeIcon: document.getElementById('themeIcon'),
      navItems: document.querySelectorAll('.nav-item'),
      contentSections: document.querySelectorAll('.content-section'),
      chatToggle: document.getElementById('chatToggle'),
      chatWindow: document.getElementById('chatWindow'),
      chatClose: document.getElementById('chatClose'),
      chatInput: document.getElementById('chatInput'),
      chatSend: document.getElementById('chatSend'),
      chatMessages: document.getElementById('chatMessages'),
      filterBtns: document.querySelectorAll('.filter-btn'),
      loginBtn: document.getElementById('loginBtn')
    };

    // Initialize application
    function init() {
      loadTheme();
      setupEventListeners();
      showSection('inicio');
    }

    // Theme management
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);
    }

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    }

    function updateThemeIcon(theme) {
      elements.themeIcon.className = theme === 'light' 
        ? 'fas fa-moon text-xl' 
        : 'fas fa-sun text-xl text-yellow-400';
    }

    // Navigation
    function showSection(sectionName) {
      // Update navigation
      elements.navItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-section') === sectionName) {
          item.classList.add('active');
        }
      });

      // Update content sections
      elements.contentSections.forEach(section => {
        section.classList.add('hidden');
        if (section.id === sectionName) {
          section.classList.remove('hidden');
          section.classList.add('fade-in');
        }
      });

      currentSection = sectionName;
    }

    // Chat functionality
    function toggleChat() {
      const isVisible = !elements.chatWindow.classList.contains('hidden');
      if (isVisible) {
        elements.chatWindow.classList.add('hidden');
      } else {
        elements.chatWindow.classList.remove('hidden');
      }
    }

    function sendMessage() {
      const message = elements.chatInput.value.trim();
      if (!message) return;

      // Add user message
      addChatMessage(message, 'user');
      elements.chatInput.value = '';

      // Simulate bot response
      setTimeout(() => {
        const responses = {
          'hola': '¡Hola! ¿En qué puedo ayudarte hoy?',
          'buscar': 'Puedes buscar recursos usando la barra de búsqueda principal o navegando por las diferentes secciones.',
          'acceso': 'Para acceder a las bases de datos, ve a la sección "Bases de Datos" y haz clic en "Acceder" en el recurso que te interese.',
          'ayuda': 'Estoy aquí para ayudarte con cualquier duda sobre la biblioteca . Puedes preguntarme sobre búsquedas, acceso a recursos, o servicios.',
          'default': 'Gracias por tu mensaje. ¿Puedes ser más específico sobre lo que necesitas? Puedo ayudarte con búsquedas, acceso a bases de datos, o información general.'
        };

        let response = responses.default;
        const lowerMessage = message.toLowerCase();
        
        for (const key in responses) {
          if (lowerMessage.includes(key)) {
            response = responses[key];
            break;
          }
        }

        addChatMessage(response, 'bot');
      }, 1000);
    }

    function addChatMessage(message, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `mb-3 ${sender === 'user' ? 'text-right' : ''}`;
      
      const messageBubble = document.createElement('div');
      messageBubble.className = `inline-block p-3 rounded-lg max-w-xs text-sm ${
        sender === 'user' 
          ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-br-none' 
          : 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-none'
      }`;
      messageBubble.textContent = message;
      
      messageDiv.appendChild(messageBubble);
      elements.chatMessages.appendChild(messageDiv);
      elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
    }

    // Filter functionality
    function handleFilterClick(filterBtn) {
      elements.filterBtns.forEach(btn => btn.classList.remove('active'));
      filterBtn.classList.add('active');
      
      // Here you would implement actual filtering logic
      const filterType = filterBtn.textContent.trim();
      console.log('Filtering by:', filterType);
    }

    // Event listeners
    function setupEventListeners() {
      // Theme toggle
      elements.themeToggle.addEventListener('click', toggleTheme);

      // Navigation
      elements.navItems.forEach(item => {
        item.addEventListener('click', () => {
          const section = item.getAttribute('data-section');
          showSection(section);
        });
      });

      // Chat
      elements.chatToggle.addEventListener('click', toggleChat);
      elements.chatClose.addEventListener('click', toggleChat);
      elements.chatSend.addEventListener('click', sendMessage);
      elements.chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });

      // Filters
      elements.filterBtns.forEach(btn => {
        btn.addEventListener('click', () => handleFilterClick(btn));
      });

      // Login button
      elements.loginBtn.addEventListener('click', () => {
        alert('Función de login en desarrollo');
      });

      // Search functionality
      const searchInput = document.querySelector('.search-input');
      if (searchInput) {
        searchInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            const query = e.target.value.trim();
            if (query) {
              alert(`Buscando: "${query}"`);
              // Here you would implement actual search
            }
          }
        });
      }

      // Resource card interactions
      document.addEventListener('click', (e) => {
        if (e.target.closest('.btn-primary')) {
          const card = e.target.closest('.resource-card');
          if (card) {
            const title = card.querySelector('h4').textContent;
            alert(`Accediendo a: ${title}`);
          }
        }
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Escape key closes chat
        if (e.key === 'Escape') {
          elements.chatWindow.classList.add('hidden');
        }
        
        // Ctrl/Cmd + K for search focus
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          searchInput?.focus();
        }
      });
    }

    // Notification system
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
      
      const colors = {
        success: 'bg-green-500 text-white',
        error: 'bg-red-500 text-white',
        warning: 'bg-yellow-500 text-black',
        info: 'bg-blue-500 text-white'
      };
      
      notification.className += ` ${colors[type] || colors.info}`;
      notification.innerHTML = `
        <div class="flex items-center gap-3">
          <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}-circle"></i>
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-auto">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    // Enhanced search with suggestions
    function setupAdvancedSearch() {
      const searchInput = document.querySelector('.search-input');
      if (!searchInput) return;

      let searchTimeout;
      
      searchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();
        
        if (query.length < 2) {
          hideSuggestions();
          return;
        }
        
        searchTimeout = setTimeout(() => {
          showSearchSuggestions(query);
        }, 300);
      });
    }

    function showSearchSuggestions(query) {
      // Mock search suggestions
      const suggestions = [
        'Inteligencia Artificial',
        'Sostenibilidad Ambiental',
        'Ingeniería de Software',
        'Biomedicina',
        'Ciencias Sociales'
      ].filter(item => item.toLowerCase().includes(query.toLowerCase()));

      if (suggestions.length === 0) return;

      // Create suggestions dropdown
      const existingDropdown = document.getElementById('search-suggestions');
      if (existingDropdown) {
        existingDropdown.remove();
      }

      const dropdown = document.createElement('div');
      dropdown.id = 'search-suggestions';
      dropdown.className = 'absolute top-full left-0 right-0 bg-white dark:bg-gray-800 rounded-lg shadow-lg mt-2 z-10 border border-gray-200 dark:border-gray-700';
      
      dropdown.innerHTML = suggestions.map(suggestion => `
        <div class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b last:border-b-0 border-gray-200 dark:border-gray-700">
          <i class="fas fa-search mr-2 text-gray-400"></i>
          ${suggestion}
        </div>
      `).join('');

      const searchContainer = document.querySelector('.search-bar');
      searchContainer.style.position = 'relative';
      searchContainer.appendChild(dropdown);

      // Handle suggestion clicks
      dropdown.addEventListener('click', (e) => {
        const suggestion = e.target.closest('div');
        if (suggestion) {
          const text = suggestion.textContent.trim();
          document.querySelector('.search-input').value = text;
          dropdown.remove();
        }
      });
    }

    function hideSuggestions() {
      const dropdown = document.getElementById('search-suggestions');
      if (dropdown) {
        dropdown.remove();
      }
    }

    // Click outside to hide suggestions
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.search-bar')) {
        hideSuggestions();
      }
    });

    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      init();
      setupAdvancedSearch();
      
      // Show welcome notification
      setTimeout(() => {
        showNotification('¡Bienvenido a la Biblioteca Digital ', 'success');
      }, 1000);
    });

    // Progressive Web App features
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Service worker registration would go here
        console.log('PWA features available');
      });
    }

    // Performance optimization: Lazy load images
    function setupLazyLoading() {
      const images = document.querySelectorAll('img[data-src]');
      const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.removeAttribute('data-src');
            imageObserver.unobserve(img);
          }
        });
      });

      images.forEach(img => imageObserver.observe(img));
    }

    // Analytics tracking (mock)
    function trackEvent(action, category, label) {
      console.log('Event tracked:', { action, category, label });
      // Here you would send to your analytics service
    }

    // Add event tracking to key interactions
    document.addEventListener('click', (e) => {
      if (e.target.matches('.btn-primary')) {
        trackEvent('click', 'button', 'primary-action');
      }
      if (e.target.closest('.nav-item')) {
        const section = e.target.closest('.nav-item').getAttribute('data-section');
        trackEvent('navigation', 'section', section);
      }
    });
  </script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      createUserWithEmailAndPassword, 
      signOut, 
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { 
      getFirestore, 
      collection, 
      getDocs, 
      addDoc, 
      query, 
      where, 
      orderBy, 
      serverTimestamp,
      doc,
      updateDoc,
      getDoc,
      limit,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAQZwAqOUHYoz1zICz7PXJt01q0FEJa15o",
      authDomain: "lectorium-a312d.firebaseapp.com",
      projectId: "lectorium-a312d",
      storageBucket: "lectorium-a312d.firebasestorage.app",
      messagingSenderId: "177236654132",
      appId: "1:177236654132:web:e00ecfcced130e89f0b261"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Global variables
    let currentUser = null;
    let books = [];
    let userLoans = [];
    let isLoginMode = true;

    // DOM Elements
    const elements = {
      // Theme
      themeToggle: document.getElementById('themeToggle'),
      themeIcon: document.getElementById('themeIcon'),
      
      // Header
      notificationBtn: document.getElementById('notificationBtn'),
      notificationCount: document.getElementById('notificationCount'),
      loginBtn: document.getElementById('loginBtn'),
      userMenu: document.getElementById('userMenu'),
      userMenuBtn: document.getElementById('userMenuBtn'),
      userDropdown: document.getElementById('userDropdown'),
      userEmail: document.getElementById('userEmail'),
      dropdownName: document.getElementById('dropdownName'),
      dropdownEmail: document.getElementById('dropdownEmail'),
      profileBtn: document.getElementById('profileBtn'),
      historyBtn: document.getElementById('historyBtn'),
      logoutBtn: document.getElementById('logoutBtn'),
      
      // Tabs
      tabBtns: document.querySelectorAll('.tab-btn'),
      tabContents: document.querySelectorAll('.tab-content'),
      
      // Dashboard
      totalBooksCount: document.getElementById('totalBooksCount'),
      availableBooksCount: document.getElementById('availableBooksCount'),
      myLoansCount: document.getElementById('myLoansCount'),
      dueSoonCount: document.getElementById('dueSoonCount'),
      recentBooks: document.getElementById('recentBooks'),
      
      // Catalog
      searchInput: document.getElementById('searchInput'),
      categoryFilter: document.getElementById('categoryFilter'),
      searchBtn: document.getElementById('searchBtn'),
      activeFilters: document.getElementById('activeFilters'),
      loadingBooks: document.getElementById('loadingBooks'),
      booksGrid: document.getElementById('booksGrid'),
      noResults: document.getElementById('noResults'),
      
      // Loans
      loansContainer: document.getElementById('loansContainer'),
      
      // Analytics
      topBooks: document.getElementById('topBooks'),
      
      // Auth Modal
      authModal: document.getElementById('authModal'),
      authForm: document.getElementById('authForm'),
      authTitle: document.getElementById('authTitle'),
      authSubtitle: document.getElementById('authSubtitle'),
      authError: document.getElementById('authError'),
      authSubmitBtn: document.getElementById('authSubmitBtn'),
      authToggleBtn: document.getElementById('authToggleBtn'),
      authCancelBtn: document.getElementById('authCancelBtn'),
      nameField: document.getElementById('nameField'),
      fullName: document.getElementById('fullName'),
      email: document.getElementById('email'),
      password: document.getElementById('password'),
      togglePassword: document.getElementById('togglePassword'),
      confirmPasswordField: document.getElementById('confirmPasswordField'),
      confirmPassword: document.getElementById('confirmPassword'),
      
      // Book Modal
      bookModal: document.getElementById('bookModal'),
      bookModalContent: document.getElementById('bookModalContent'),
      
      // Toast
      toastContainer: document.getElementById('toastContainer')
    };

    // Theme Toggle
    elements.themeToggle.addEventListener('click', () => {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      html.setAttribute('data-theme', newTheme);
      elements.themeIcon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun text-yellow-300';
      
      localStorage.setItem('theme', newTheme);
    });

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    elements.themeIcon.className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun text-yellow-300';

    // Tab Navigation
    elements.tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const tabName = btn.getAttribute('data-tab');
        
        elements.tabBtns.forEach(b => b.classList.remove('tab-active'));
        btn.classList.add('tab-active');
        
        elements.tabContents.forEach(content => {
          content.classList.add('hidden');
          if (content.id === `${tabName}-tab`) {
            content.classList.remove('hidden');
            
            if (tabName === 'analytics' && currentUser) {
              setTimeout(initCharts, 100);
            }
          }
        });
      });
    });

    // Toast Notifications
    window.showNotification = function(message, type = 'info') {
      const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        info: 'fa-info-circle',
        warning: 'fa-exclamation-triangle'
      };
      
      const colors = {
        success: 'text-green-600',
        error: 'text-red-600',
        info: 'text-blue-600',
        warning: 'text-yellow-600'
      };
      
      const toast = document.createElement('div');
      toast.className = 'toast bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200';
      toast.innerHTML = `
        <div class="flex items-center space-x-3">
          <i class="fas ${icons[type]} ${colors[type]} text-xl"></i>
          <span class="font-medium">${message}</span>
        </div>
      `;
      
      elements.toastContainer.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 100);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    };

    // Initial books data
    const initialBooks = [
      { 
        titulo: "Cien Años de Soledad", 
        autor: "Gabriel García Márquez", 
        categoria: "moderno", 
        disponible: true,
        isbn: "978-0-06-088328-7",
        año: 1967,
        editorial: "Harper & Row",
        paginas: 417,
        descripcion: "La historia épica de la familia Buendía a lo largo de siete generaciones en el pueblo ficticio de Macondo.",
        vecesPrestado: 0
      },
      { 
        titulo: "Don Quijote de la Mancha", 
        autor: "Miguel de Cervantes", 
        categoria: "clasico", 
        disponible: true,
        isbn: "978-84-376-0494-7",
        año: 1605,
        editorial: "Francisco de Robles",
        paginas: 1023,
        descripcion: "Las aventuras del hidalgo Don Quijote y su fiel escudero Sancho Panza.",
        vecesPrestado: 0
      },
      { 
        titulo: "1984", 
        autor: "George Orwell", 
        categoria: "ficcion", 
        disponible: true,
        isbn: "978-0-452-28423-4",
        año: 1949,
        editorial: "Secker & Warburg",
        paginas: 328,
        descripcion: "Una distopía en la que un superestado totalitario controla cada aspecto de la vida.",
        vecesPrestado: 0
      },
      { 
        titulo: "El Principito", 
        autor: "Antoine de Saint-Exupéry", 
        categoria: "infantil", 
        disponible: true,
        isbn: "978-0-15-601219-5",
        año: 1943,
        editorial: "Reynal & Hitchcock",
        paginas: 96,
        descripcion: "Un piloto se encuentra en el desierto del Sahara con un pequeño príncipe de otro planeta.",
        vecesPrestado: 0
      },
      { 
        titulo: "Harry Potter y la Piedra Filosofal", 
        autor: "J.K. Rowling", 
        categoria: "juvenil", 
        disponible: true,
        isbn: "978-0-439-70818-8",
        año: 1997,
        editorial: "Bloomsbury",
        paginas: 223,
        descripcion: "Las aventuras de un joven mago en su primer año en Hogwarts.",
        vecesPrestado: 0
      },
      { 
        titulo: "Sapiens", 
        autor: "Yuval Noah Harari", 
        categoria: "ciencia", 
        disponible: true,
        isbn: "978-0-06-231609-7",
        año: 2011,
        editorial: "Harper",
        paginas: 443,
        descripcion: "Una breve historia de la humanidad desde la Edad de Piedra hasta el siglo XXI.",
        vecesPrestado: 0
      },
      { 
        titulo: "El Diario de Ana Frank", 
        autor: "Ana Frank", 
        categoria: "historia", 
        disponible: true,
        isbn: "978-0-553-29698-3",
        año: 1947,
        editorial: "Contact Publishing",
        paginas: 283,
        descripcion: "El diario íntimo de una niña judía durante la Segunda Guerra Mundial.",
        vecesPrestado: 0
      }
    ];

    // Initialize books collection
    async function initializeBooks() {
      try {
        const booksRef = collection(db, "libros");
        const snapshot = await getDocs(booksRef);
        
        if (snapshot.empty) {
          console.log('Initializing books collection...');
          for (const book of initialBooks) {
            await addDoc(booksRef, {
              ...book,
              fechaAgregado: serverTimestamp()
            });
          }
          showNotification('Biblioteca inicializada con éxito', 'success');
        }
      } catch (error) {
        console.error('Error initializing books:', error);
        showNotification('Error al inicializar la biblioteca', 'error');
      }
    }

    // Load books
    async function loadBooks() {
      try {
        elements.loadingBooks.classList.remove('hidden');
        elements.booksGrid.classList.add('hidden');
        
        await initializeBooks();
        
        const snapshot = await getDocs(collection(db, "libros"));
        books = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        updateDashboardStats();
        displayBooks(books);
        displayRecentBooks();
        
        elements.loadingBooks.classList.add('hidden');
        elements.booksGrid.classList.remove('hidden');
      } catch (error) {
        console.error('Error loading books:', error);
        showNotification('Error al cargar los libros', 'error');
        elements.loadingBooks.classList.add('hidden');
      }
    }

    // Update dashboard statistics
    function updateDashboardStats() {
      const totalBooks = books.length;
      const availableBooks = books.filter(book => book.disponible).length;
      const myLoans = userLoans.filter(loan => loan.estado === 'activo').length;
      const dueSoon = userLoans.filter(loan => {
        if (loan.estado !== 'activo') return false;
        const daysLeft = calculateDaysLeft(loan.fechaVencimiento);
        return daysLeft >= 0 && daysLeft <= 7;
      }).length;
      
      elements.totalBooksCount.textContent = totalBooks;
      elements.availableBooksCount.textContent = availableBooks;
      elements.myLoansCount.textContent = myLoans;
      elements.dueSoonCount.textContent = dueSoon;
      
      // Update notification count
      if (dueSoon > 0) {
        elements.notificationCount.textContent = dueSoon;
        elements.notificationCount.classList.remove('hidden');
      } else {
        elements.notificationCount.classList.add('hidden');
      }
    }

    // Display recent books
    function displayRecentBooks() {
      const recentBooks = books
        .sort((a, b) => (b.fechaAgregado?.seconds || 0) - (a.fechaAgregado?.seconds || 0))
        .slice(0, 5);
      
      elements.recentBooks.innerHTML = recentBooks.map(book => `
        <div class="flex items-center justify-between p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg cursor-pointer" onclick="showBookDetails('${book.id}')">
          <div>
            <p class="font-semibold">${book.titulo}</p>
            <p class="text-sm opacity-70">${book.autor}</p>
          </div>
          <span class="text-xs px-2 py-1 rounded-full ${book.disponible ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
            ${book.disponible ? 'Disponible' : 'Prestado'}
          </span>
        </div>
      `).join('');
    }

    // Display books
    function displayBooks(booksToShow) {
      elements.booksGrid.innerHTML = '';
      
      if (booksToShow.length === 0) {
        elements.noResults.classList.remove('hidden');
        return;
      }
      
      elements.noResults.classList.add('hidden');
      
      booksToShow.forEach(book => {
        const card = document.createElement('div');
        card.className = 'glass rounded-xl overflow-hidden book-card cursor-pointer';
        
        const categoryColors = {
          clasico: 'from-amber-500 to-orange-600',
          moderno: 'from-purple-500 to-pink-600',
          ficcion: 'from-blue-500 to-indigo-600',
          ciencia: 'from-green-500 to-teal-600',
          historia: 'from-red-500 to-pink-600',
          infantil: 'from-yellow-400 to-orange-500',
          juvenil: 'from-pink-500 to-purple-600'
        };
        
        const gradient = categoryColors[book.categoria] || 'from-gray-500 to-gray-600';
        
        card.innerHTML = `
          <div class="relative">
            <div class="bg-gradient-to-br ${gradient} h-48 flex items-center justify-center">
              <i class="fas fa-book text-white text-5xl opacity-80"></i>
            </div>
            <div class="absolute top-2 right-2 bg-${book.disponible ? 'green' : 'red'}-500 text-white px-2 py-1 rounded-full text-xs font-semibold">
              ${book.disponible ? 'Disponible' : 'Prestado'}
            </div>
          </div>
          <div class="p-4">
            <h3 class="font-semibold text-lg mb-1 line-clamp-1">${book.titulo}</h3>
            <p class="text-sm opacity-70 mb-2">${book.autor}</p>
            <p class="text-xs opacity-60 mb-3">ISBN: ${book.isbn || 'No disponible'}</p>
            <div class="flex space-x-2">
              <button onclick="event.stopPropagation(); ${book.disponible ? `requestBook('${book.id}')` : 'showNotification(\'Este libro no está disponible\', \'warning\')'}" 
                class="flex-1 bg-purple-600 text-white py-2 rounded-lg text-sm font-semibold micro-interaction ${!book.disponible ? 'opacity-50 cursor-not-allowed' : ''}">
                ${book.disponible ? 'Solicitar' : 'No disponible'}
              </button>
              <button onclick="event.stopPropagation(); showBookDetails('${book.id}')" class="p-2 glass rounded-lg micro-interaction">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
          </div>
        `;
        
        card.addEventListener('click', () => showBookDetails(book.id));
        elements.booksGrid.appendChild(card);
      });
    }

    // Show book details
    window.showBookDetails = function(bookId) {
      const book = books.find(b => b.id === bookId);
      if (!book) return;
      
      const categoryColors = {
        clasico: 'from-amber-500 to-orange-600',
        moderno: 'from-purple-500 to-pink-600',
        ficcion: 'from-blue-500 to-indigo-600',
        ciencia: 'from-green-500 to-teal-600',
        historia: 'from-red-500 to-pink-600',
        infantil: 'from-yellow-400 to-orange-500',
        juvenil: 'from-pink-500 to-purple-600'
      };
      
      const gradient = categoryColors[book.categoria] || 'from-gray-500 to-gray-600';
      
      elements.bookModalContent.innerHTML = `
        <div class="flex justify-between items-start mb-6">
          <h2 class="text-2xl font-bold tracking-tight">${book.titulo}</h2>
          <button onclick="closeBookModal()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <div class="bg-gradient-to-br ${gradient} h-64 rounded-lg mb-4 flex items-center justify-center">
              <i class="fas fa-book text-white text-6xl opacity-80"></i>
            </div>
            <div class="space-y-2 text-sm">
              <p><span class="font-medium">Autor:</span> ${book.autor}</p>
              <p><span class="font-medium">ISBN:</span> ${book.isbn || 'No disponible'}</p>
              <p><span class="font-medium">Año:</span> ${book.año || 'No disponible'}</p>
              <p><span class="font-medium">Editorial:</span> ${book.editorial || 'No disponible'}</p>
              <p><span class="font-medium">Páginas:</span> ${book.paginas || 'No disponible'}</p>
              <p><span class="font-medium">Categoría:</span> ${book.categoria}</p>
              <p><span class="font-medium">Veces prestado:</span> ${book.vecesPrestado || 0}</p>
            </div>
          </div>
          
          <div>
            <h3 class="font-semibold text-lg mb-3">Descripción</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-6 leading-relaxed">
              ${book.descripcion || 'No hay descripción disponible para este libro.'}
            </p>
            
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-6">
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Estado del libro:</p>
              <p class="text-lg font-semibold ${book.disponible ? 'text-green-600' : 'text-red-600'}">
                ${book.disponible ? '✓ Disponible para préstamo' : '✗ Actualmente prestado'}
              </p>
            </div>
            
            ${currentUser ? `
              <button 
                onclick="${book.disponible ? `requestBook('${book.id}'); closeBookModal();` : 'showNotification(\'Este libro no está disponible\', \'warning\')'}" 
                class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold micro-interaction ${!book.disponible ? 'opacity-50 cursor-not-allowed' : ''}"
              >
                ${book.disponible ? 'Solicitar Préstamo' : 'No Disponible'}
              </button>
            ` : `
              <button 
                onclick="closeBookModal(); elements.authModal.classList.remove('hidden');" 
                class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold micro-interaction"
              >
                Iniciar sesión para solicitar préstamo
              </button>
            `}
          </div>
        </div>
      `;
      
      elements.bookModal.classList.remove('hidden');
    };

    window.closeBookModal = function() {
      elements.bookModal.classList.add('hidden');
    };

    // Request book
    window.requestBook = async function(bookId) {
      if (!currentUser) {
        showNotification('Debes iniciar sesión para solicitar libros', 'warning');
        elements.authModal.classList.remove('hidden');
        return;
      }
      
      try {
        const book = books.find(b => b.id === bookId);
        if (!book || !book.disponible) {
          showNotification('Este libro no está disponible', 'error');
          return;
        }
        
        // Check if user already has this book
        const loansRef = collection(db, "prestamos");
        const q = query(loansRef, 
          where("userId", "==", currentUser.uid),
          where("libroId", "==", bookId),
          where("estado", "==", "activo")
        );
        const existingLoans = await getDocs(q);
        
        if (!existingLoans.empty) {
          showNotification('Ya tienes este libro en préstamo', 'warning');
          return;
        }
        
        // Check loan limit (max 3 books)
        const activeLoansQuery = query(loansRef,
          where("userId", "==", currentUser.uid),
          where("estado", "==", "activo")
        );
        const activeLoans = await getDocs(activeLoansQuery);
        
        if (activeLoans.size >= 3) {
          showNotification('Has alcanzado el límite de 3 préstamos activos', 'warning');
          return;
        }
        
        // Create loan
        const loanData = {
          userId: currentUser.uid,
          userEmail: currentUser.email,
          userName: currentUser.displayName || 'Usuario',
          libroId: bookId,
          titulo: book.titulo,
          autor: book.autor,
          isbn: book.isbn || 'No disponible',
          fechaPrestamo: serverTimestamp(),
          fechaVencimiento: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), // 14 days
          estado: "activo",
          renovaciones: 0
        };
        
        await addDoc(collection(db, "prestamos"), loanData);
        
        // Update book availability
        await updateDoc(doc(db, "libros", bookId), { 
          disponible: false,
          vecesPrestado: (book.vecesPrestado || 0) + 1
        });
        
        showNotification(`¡Préstamo exitoso! Tienes 14 días para devolver "${book.titulo}"`, 'success');
        
        await loadBooks();
        await loadLoans();
      } catch (error) {
        console.error('Error requesting book:', error);
        showNotification('Error al procesar el préstamo', 'error');
      }
    };

    // Load user loans
    async function loadLoans() {
      if (!currentUser) {
        elements.loansContainer.innerHTML = `
          <div class="text-center py-12">
            <i class="fas fa-lock text-6xl opacity-20 mb-4"></i>
            <p class="text-xl font-semibold opacity-70">Inicia sesión para ver tus préstamos</p>
          </div>
        `;
        return;
      }
      
      try {
        const q = query(
          collection(db, "prestamos"),
          where("userId", "==", currentUser.uid),
          where("estado", "==", "activo"),
          orderBy("fechaPrestamo", "desc")
        );
        
        const snapshot = await getDocs(q);
        userLoans = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        displayLoans();
        updateDashboardStats();
      } catch (error) {
        console.error('Error loading loans:', error);
        showNotification('Error al cargar los préstamos', 'error');
      }
    }

    // Display loans
    function displayLoans() {
      if (userLoans.length === 0) {
        elements.loansContainer.innerHTML = `
          <div class="text-center py-12">
            <i class="fas fa-book-open text-6xl opacity-20 mb-4"></i>
            <p class="text-xl font-semibold opacity-70">No tienes préstamos activos</p>
            <p class="text-sm opacity-50 mt-2">¡Explora nuestro catálogo y encuentra tu próxima lectura!</p>
          </div>
        `;
        return;
      }
      
      elements.loansContainer.innerHTML = userLoans.map(loan => {
        const daysLeft = calculateDaysLeft(loan.fechaVencimiento);
        const isOverdue = daysLeft < 0;
        const isNearDue = daysLeft >= 0 && daysLeft <= 3;
        
        return `
          <div class="glass rounded-lg p-4 ${isOverdue ? 'border-2 border-red-500' : isNearDue ? 'border-2 border-yellow-500' : ''}">
            <div class="flex justify-between items-start">
              <div>
                <h4 class="font-semibold text-lg">${loan.titulo}</h4>
                <p class="text-sm opacity-70">${loan.autor}</p>
                <div class="mt-2 space-y-1 text-sm">
                  <p><i class="fas fa-calendar-check mr-2"></i>Prestado: ${formatDate(loan.fechaPrestamo)}</p>
                  <p><i class="fas fa-calendar-times mr-2"></i>Vence: ${formatDate(loan.fechaVencimiento)}</p>
                  ${loan.renovaciones > 0 ? `<p><i class="fas fa-sync mr-2"></i>Renovaciones: ${loan.renovaciones}/2</p>` : ''}
                </div>
                <div class="mt-3">
                  ${isOverdue ? 
                    `<span class="text-red-600 font-semibold"><i class="fas fa-exclamation-triangle mr-1"></i>Vencido hace ${Math.abs(daysLeft)} días</span>` : 
                    isNearDue ?
                    `<span class="text-yellow-600 font-semibold"><i class="fas fa-clock mr-1"></i>Vence en ${daysLeft} días</span>` :
                    `<span class="text-green-600 font-semibold"><i class="fas fa-check-circle mr-1"></i>${daysLeft} días restantes</span>`
                  }
                </div>
              </div>
              
              <div class="flex flex-col space-y-2">
                <button onclick="returnBook('${loan.id}', '${loan.libroId}')" 
                  class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold micro-interaction">
                  <i class="fas fa-undo mr-2"></i>Devolver
                </button>
                ${!isOverdue && loan.renovaciones < 2 ? `
                  <button onclick="renewLoan('${loan.id}')" 
                    class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-semibold micro-interaction">
                    <i class="fas fa-sync mr-2"></i>Renovar
                  </button>
                ` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Calculate days left
    function calculateDaysLeft(vencimiento) {
      if (!vencimiento) return 0;
      
      let due;
      if (vencimiento.toDate) {
        due = vencimiento.toDate();
      } else if (vencimiento.seconds) {
        due = new Date(vencimiento.seconds * 1000);
      } else if (vencimiento instanceof Date) {
        due = vencimiento;
      } else {
        due = new Date(vencimiento);
      }
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      due.setHours(0, 0, 0, 0);
      
      const diffTime = due - today;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      return diffDays;
    }

    // Format date
    function formatDate(timestamp) {
      if (!timestamp) return 'Fecha no disponible';
      
      let date;
      if (timestamp.toDate) {
        date = timestamp.toDate();
      } else if (timestamp.seconds) {
        date = new Date(timestamp.seconds * 1000);
      } else if (timestamp instanceof Date) {
        date = timestamp;
      } else {
        date = new Date(timestamp);
      }
      
      return date.toLocaleDateString('es-ES', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
    }

    // Return book
    window.returnBook = async function(loanId, bookId) {
      if (confirm('¿Estás seguro de que deseas devolver este libro?')) {
        try {
          await updateDoc(doc(db, "prestamos", loanId), {
            estado: "devuelto",
            fechaDevolucion: serverTimestamp()
          });
          
          await updateDoc(doc(db, "libros", bookId), { disponible: true });
          
          showNotification('Libro devuelto exitosamente', 'success');
          
          await loadBooks();
          await loadLoans();
        } catch (error) {
          console.error('Error returning book:', error);
          showNotification('Error al devolver el libro', 'error');
        }
      }
    };

    // Renew loan
    window.renewLoan = async function(loanId) {
      try {
        const loan = userLoans.find(l => l.id === loanId);
        if (!loan) return;
        
        if (loan.renovaciones >= 2) {
          showNotification('Has alcanzado el límite de renovaciones', 'warning');
          return;
        }
        
        const newDueDate = new Date();
        if (loan.fechaVencimiento.toDate) {
          newDueDate.setTime(loan.fechaVencimiento.toDate().getTime());
        } else if (loan.fechaVencimiento.seconds) {
          newDueDate.setTime(loan.fechaVencimiento.seconds * 1000);
        } else {
          newDueDate.setTime(new Date(loan.fechaVencimiento).getTime());
        }
        newDueDate.setDate(newDueDate.getDate() + 7); // Add 7 days
        
        await updateDoc(doc(db, "prestamos", loanId), {
          fechaVencimiento: newDueDate,
          renovaciones: loan.renovaciones + 1
        });
        
        showNotification('Préstamo renovado por 7 días adicionales', 'success');
        await loadLoans();
      } catch (error) {
        console.error('Error renewing loan:', error);
        showNotification('Error al renovar el préstamo', 'error');
      }
    };

    // Search and filter
    elements.searchBtn.addEventListener('click', filterBooks);
    elements.searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') filterBooks();
    });
    elements.categoryFilter.addEventListener('change', filterBooks);

    function filterBooks() {
      const searchTerm = elements.searchInput.value.toLowerCase().trim();
      const category = elements.categoryFilter.value;
      
      let filtered = books;
      
      if (searchTerm) {
        filtered = filtered.filter(book => 
          book.titulo.toLowerCase().includes(searchTerm) ||
          book.autor.toLowerCase().includes(searchTerm) ||
          (book.isbn && book.isbn.toLowerCase().includes(searchTerm))
        );
      }
      
      if (category) {
        filtered = filtered.filter(book => book.categoria === category);
      }
      
      displayBooks(filtered);
      updateActiveFilters(searchTerm, category);
    }

    function updateActiveFilters(search, category) {
      elements.activeFilters.innerHTML = '';
      const filters = [];
      
      if (search) {
        filters.push(`Búsqueda: "${search}"`);
      }
      
      if (category) {
        const categoryText = elements.categoryFilter.options[elements.categoryFilter.selectedIndex].text;
        filters.push(`Categoría: ${categoryText}`);
      }
      
      if (filters.length > 0) {
        elements.activeFilters.classList.remove('hidden');
        filters.forEach(filter => {
          const chip = document.createElement('span');
          chip.className = 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 px-3 py-1 rounded-full text-sm font-medium';
          chip.innerHTML = `
            ${filter}
            <button onclick="clearFilters()" class="ml-2 hover:text-purple-900">
              <i class="fas fa-times"></i>
            </button>
          `;
          elements.activeFilters.appendChild(chip);
        });
      } else {
        elements.activeFilters.classList.add('hidden');
      }
    }

    window.clearFilters = function() {
      elements.searchInput.value = '';
      elements.categoryFilter.value = '';
      filterBooks();
    };

    // Initialize charts
    async function initCharts() {
      // Monthly chart
      const monthlyCtx = document.getElementById('monthlyChart');
      if (monthlyCtx && Chart.getChart(monthlyCtx)) {
        Chart.getChart(monthlyCtx).destroy();
      }
      
      if (monthlyCtx) {
        new Chart(monthlyCtx, {
          type: 'line',
          data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
            datasets: [{
              label: 'Préstamos',
              data: [12, 19, 15, 25, 22, 30],
              borderColor: 'rgb(102, 126, 234)',
              backgroundColor: 'rgba(102, 126, 234, 0.1)',
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false }
            }
          }
        });
      }
      
      // Category chart
      const categoryCtx = document.getElementById('categoryChart');
      if (categoryCtx && Chart.getChart(categoryCtx)) {
        Chart.getChart(categoryCtx).destroy();
      }
      
      if (categoryCtx) {
        const categoryCount = {};
        books.forEach(book => {
          categoryCount[book.categoria] = (categoryCount[book.categoria] || 0) + 1;
        });
        
        new Chart(categoryCtx, {
          type: 'doughnut',
          data: {
            labels: Object.keys(categoryCount),
            datasets: [{
              data: Object.values(categoryCount),
              backgroundColor: [
                'rgba(102, 126, 234, 0.8)',
                'rgba(72, 187, 120, 0.8)',
                'rgba(246, 173, 85, 0.8)',
                'rgba(237, 100, 166, 0.8)',
                'rgba(160, 174, 192, 0.8)',
                'rgba(252, 129, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)'
              ]
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' }
            }
          }
        });
      }
      
      // Top books
      const topBooks = books
        .sort((a, b) => (b.vecesPrestado || 0) - (a.vecesPrestado || 0))
        .slice(0, 5);
      
      elements.topBooks.innerHTML = topBooks.map((book, index) => `
        <div class="flex items-center justify-between p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
          <div class="flex items-center space-x-3">
            <span class="text-2xl font-bold text-purple-600">#${index + 1}</span>
            <div>
              <p class="font-semibold">${book.titulo}</p>
              <p class="text-sm opacity-70">${book.autor}</p>
            </div>
          </div>
          <span class="text-sm font-medium">${book.vecesPrestado || 0} préstamos</span>
        </div>
      `).join('');
    }

    // Auth functions
    const ALLOWED_DOMAIN = '@ieluiscarloslopez.edu.co';
    
    function isValidInstitutionalEmail(email) {
      return email.toLowerCase().endsWith(ALLOWED_DOMAIN.toLowerCase());
    }

    // Auth form submission
    elements.authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = elements.email.value.trim();
      const password = elements.password.value;
      
      if (!email || !password) {
        showAuthError('Por favor completa todos los campos');
        return;
      }
      
      if (!isValidInstitutionalEmail(email)) {
        showAuthError(`Solo se permiten correos institucionales ${ALLOWED_DOMAIN}`);
        return;
      }
      
      try {
        if (isLoginMode) {
          await signInWithEmailAndPassword(auth, email, password);
          showNotification('¡Bienvenido de nuevo!', 'success');
        } else {
          const fullName = elements.fullName.value.trim();
          const confirmPassword = elements.confirmPassword.value;
          
          if (!fullName) {
            showAuthError('Por favor ingresa tu nombre completo');
            return;
          }
          
          if (password !== confirmPassword) {
            showAuthError('Las contraseñas no coinciden');
            return;
          }
          
          if (password.length < 6) {
            showAuthError('La contraseña debe tener al menos 6 caracteres');
            return;
          }
          
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          await updateProfile(userCredential.user, { displayName: fullName });
          
          showNotification('¡Cuenta creada exitosamente!', 'success');
        }
        
        elements.authModal.classList.add('hidden');
        clearAuthForm();
      } catch (error) {
        showAuthError(getAuthErrorMessage(error));
      }
    });

    function showAuthError(message) {
      elements.authError.textContent = message;
      elements.authError.classList.remove('hidden');
      setTimeout(() => elements.authError.classList.add('hidden'), 5000);
    }

    function clearAuthForm() {
      elements.authForm.reset();
      elements.authError.classList.add('hidden');
    }

    function getAuthErrorMessage(error) {
      const errorMessages = {
        'auth/user-not-found': `No existe una cuenta con este correo. Verifica que sea un correo ${ALLOWED_DOMAIN}`,
        'auth/wrong-password': 'Contraseña incorrecta',
        'auth/email-already-in-use': 'Este correo ya está registrado',
        'auth/weak-password': 'La contraseña debe tener al menos 6 caracteres',
        'auth/invalid-email': 'El correo electrónico no es válido',
        'auth/too-many-requests': 'Demasiados intentos. Intenta más tarde'
      };
      
      return errorMessages[error.code] || 'Error desconocido. Intenta nuevamente.';
    }

    // Toggle login/register
    elements.authToggleBtn.addEventListener('click', () => {
      isLoginMode = !isLoginMode;
      
      if (isLoginMode) {
        elements.authTitle.textContent = 'Iniciar Sesión';
        elements.authSubtitle.textContent = 'Accede a la biblioteca digital';
        elements.authSubmitBtn.textContent = 'Iniciar Sesión';
        elements.authToggleBtn.textContent = '¿No tienes cuenta? Regístrate';
        elements.nameField.classList.add('hidden');
        elements.confirmPasswordField.classList.add('hidden');
      } else {
        elements.authTitle.textContent = 'Crear Cuenta';
        elements.authSubtitle.textContent = 'Únete a la biblioteca digital';
        elements.authSubmitBtn.textContent = 'Registrarse';
        elements.authToggleBtn.textContent = '¿Ya tienes cuenta? Inicia sesión';
        elements.nameField.classList.remove('hidden');
        elements.confirmPasswordField.classList.remove('hidden');
      }
      
      clearAuthForm();
    });

    // Password visibility toggle
    elements.togglePassword.addEventListener('click', () => {
      const type = elements.password.type === 'password' ? 'text' : 'password';
      elements.password.type = type;
      elements.confirmPassword.type = type;
      elements.togglePassword.innerHTML = `<i class="fas fa-eye${type === 'password' ? '' : '-slash'}"></i>`;
    });

    // Auth state observer
    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      
      if (user) {
        elements.loginBtn.classList.add('hidden');
        elements.userMenu.classList.remove('hidden');
        
        const displayName = user.displayName || user.email.split('@')[0];
        elements.userEmail.textContent = displayName;
        elements.dropdownName.textContent = displayName;
        elements.dropdownEmail.textContent = user.email;
        
        await loadLoans();
      } else {
        elements.loginBtn.classList.remove('hidden');
        elements.userMenu.classList.add('hidden');
        userLoans = [];
      }
      
      updateDashboardStats();
    });

    // Event listeners
    elements.loginBtn.addEventListener('click', () => {
      elements.authModal.classList.remove('hidden');
    });

    elements.authCancelBtn.addEventListener('click', () => {
      elements.authModal.classList.add('hidden');
      clearAuthForm();
    });

    elements.logoutBtn.addEventListener('click', async () => {
      await signOut(auth);
      showNotification('Sesión cerrada exitosamente', 'info');
      window.location.reload();
    });

    elements.userMenuBtn.addEventListener('click', () => {
      elements.userDropdown.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!elements.userMenu.contains(e.target)) {
        elements.userDropdown.classList.add('hidden');
      }
    });

    // Close modals on outside click
    window.addEventListener('click', (e) => {
      if (e.target === elements.authModal) {
        elements.authModal.classList.add('hidden');
        clearAuthForm();
      }
      if (e.target === elements.bookModal) {
        elements.bookModal.classList.add('hidden');
      }
    });

    // Profile and history buttons
    elements.profileBtn.addEventListener('click', () => {
      showNotification('Perfil en construcción', 'info');
      elements.userDropdown.classList.add('hidden');
    });

    elements.historyBtn.addEventListener('click', () => {
      showNotification('Historial en construcción', 'info');
      elements.userDropdown.classList.add('hidden');
    });

    // Notification button
    elements.notificationBtn.addEventListener('click', () => {
      if (userLoans.length > 0) {
        document.querySelector('[data-tab="loans"]').click();
      } else {
        showNotification('No tienes notificaciones pendientes', 'info');
      }
    });

    // Initialize app
    async function init() {
      console.log('Inicializando Lectorium...');
      await loadBooks();
      
      if (currentUser) {
        await loadLoans();
      }
      
      console.log('Lectorium iniciado correctamente');
    }

    init();
</script>
</body>
</html>
